<div class="table-container" *ngIf="viewData && legSelection">
  <table mat-table [dataSource]="viewData.matchTableDataSource">
    @let defaultCol = viewData.columnDefinitions.default ;
    <ng-container [matColumnDef]="defaultCol.id">
      <th mat-header-cell *matHeaderCellDef>
        <span>{{ defaultCol.labels.darts }}</span>
        <span>{{ defaultCol.labels.round }}</span>
      </th>
      <td mat-cell *matCellDef="let rowData">
        <span>{{ rowData.dartsThrown }}</span>
        <span>{{ rowData.round }}</span>
      </td>
    </ng-container>

    @for (playerColEntry of viewData.columnDefinitions.players | keyvalue; track playerColEntry.key) {
      <ng-container [matColumnDef]="playerColEntry.key">
        <th mat-header-cell *matHeaderCellDef>
          <span *ngIf="editMode"></span>
          <span>{{ playerColEntry.value.score }}</span>
          <span>{{ playerColEntry.value.remaining }}</span>
        </th>
        <td mat-cell *matCellDef="let rowData">
          @let playerData = rowData.players[playerColEntry.key];
          <button *ngIf="editMode && playerData" mat-icon-button (click)="onEditScoreClick(playerColEntry.key, rowData)"><mat-icon>edit</mat-icon></button>
          <span>{{ playerData?.score }}</span>
          <span>{{ playerData?.remaining }}</span>
        </td>
      </ng-container>
    }

    <tr mat-header-row *matHeaderRowDef="viewData.displayedColumns ?? []; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: viewData.displayedColumns ?? []"></tr>
  </table>
</div>
